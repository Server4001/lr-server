#!/usr/bin/env node

'use strict';

let argv = require('minimist')(process.argv.slice(2));
const path = require('path');
const fs = require('fs');
const liveReload = require('../lib/liveReload');

if (argv.h !== undefined || argv.help !== undefined) {
    return fs.createReadStream(path.join(__dirname, '..', 'usage.txt'))
        .pipe(process.stdout)
        .on('close', function () { process.exit(1) });
}

if (argv.v !== undefined || argv.version !== undefined) {
    return console.log(require('../package.json').version);
}

if (argv._.length < 1) {
    console.error('Must pass in at least one path argument.');
    process.exit(1);
}

const options = {
    cwd: process.cwd(),
    debounceDelay: (argv.d || argv.debounce || 500),
    host: (argv.o || argv.host || '127.0.0.1'),
    interval: (argv.i || argv.interval || 1000),
    port: (argv.p || argv.port || 35729)
};

liveReload(argv._, options);
